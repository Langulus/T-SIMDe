cmake_minimum_required(VERSION 3.20)
include(cmake/DownloadProject.cmake)

project(T-SIMDe)

# Check if this project is used as a subdirectory
# Potential issue with this: https://gitlab.kitware.com/cmake/cmake/-/issues/18862
if(CMAKE_SOURCE_DIR STREQUAL CMAKE_CURRENT_SOURCE_DIR)
    set(CMAKE_CXX_STANDARD 20)
    set(CMAKE_CXX_STANDARD_REQUIRED ON)
    enable_testing()
endif()

# Configure SIMDe library
message(STATUS "Configuring external project: SIMDe...")
download_project(
	PROJ                SIMDe
	GIT_REPOSITORY      https://github.com/simd-everywhere/simde.git
	GIT_TAG             master
	GIT_PROGRESS        TRUE
	UPDATE_DISCONNECTED 1
)

# Build and install of the Anyness shared library
aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR} SOURCE_FILES)
add_library(T-SIMDe INTERFACE)
include_directories(external/SIMDe-src)

target_include_directories(T-SIMDe
	INTERFACE ${CMAKE_CURRENT_SOURCE_DIR}/include
)

# Testing
add_subdirectory(test)
add_test(NAME TestT-SIMDe COMMAND TestT-SIMDe)
